<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE INDEX - UNIT 4/5</title>
    <style>
        :root {
            --paper: #f0ede9;
            --ink: #1a1a1b;
        }

        body {
            margin: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
        }

        #paper {
            width: 90vw;
            max-width: 400px;
            min-height: 70vh;
            background: var(--paper);
            border: 2px solid #333;
            padding: 30px;
            box-sizing: border-box;
            box-shadow: 0 0 40px rgba(0,0,0,0.8);
            position: relative;
            transition: transform 0.1s, opacity 0.3s;
        }

        .header {
            text-align: center;
            border-bottom: 2px solid var(--ink);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .status-box {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .mandate-area {
            font-size: 1.1em;
            line-height: 1.5;
            min-height: 150px;
        }

        #cooldown-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: #888;
            width: 0%;
            transition: none;
        }

        .stamp {
            position: absolute;
            bottom: 20px;
            right: 20px;
            border: 3px solid #7a0000;
            color: #7a0000;
            padding: 5px;
            font-weight: bold;
            transform: rotate(-15deg);
            opacity: 0.6;
        }

        /* Animation for shaking */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            40% { transform: translate(3px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            80% { transform: translate(3px, -1px) rotate(1deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
    </style>
</head>
<body onclick="weave()">

    <div id="paper">
        <div class="header">
            <div style="font-size: 0.8em; letter-spacing: 3px;">CITY OF ENFIELD</div>
            <div style="font-size: 1.5em; font-weight: bold;">THE INDEX</div>
        </div>

        <div class="status-box" id="status-display">STATUS: INITIALIZING...</div>
        
        <div class="mandate-area">
            <p id="subject-display" style="font-weight: bold;"></p>
            <p id="mandate-display">Tap to receive the Will.</p>
        </div>

        <div class="stamp">UNIT 4/5</div>
        <div id="cooldown-bar"></div>
    </div>

    <script>
        let isCoolingDown = false;

        const SCHEDULE = {
            1: { name: "MON", classes: [{t: 8.25, n: "ว30203"}, {t: 10.15, n: "อ31101"}, {t: 12.55, n: "ค31201"}] },
            2: { name: "TUE", classes: [{t: 8.25, n: "ว30283"}, {t: 10.15, n: "ค31201"}, {t: 13.00, n: "พ31101"}] },
            3: { name: "WED", classes: [{t: 8.25, n: "ท31101"}, {t: 10.15, n: "ว30223"}, {t: 13.00, n: "ค31101"}] },
            4: { name: "THU", classes: [{t: 8.25, n: "ว30203"}, {t: 10.15, n: "ว30243"}, {t: 13.00, n: "ส31101"}] },
            5: { name: "FRI", classes: [{t: 8.25, n: "ค31201"}, {t: 10.15, n: "อ31101"}, {t: 13.50, n: "GUIDANCE"}] }
        };

        const WILLS = [
            "Inscribe the Will into your memory.",
            "Observe the silence of your peers.",
            "Do not question the presiding authorities.",
            "Maintain the order of the Unit.",
            "The Index sees all movements.",
            "Counting breaths is a form of worship."
        ];

        function weave() {
            if (isCoolingDown) return;

            // Trigger Shake
            const paper = document.getElementById('paper');
            paper.style.animation = "shake 0.4s";
            setTimeout(() => { paper.style.animation = ""; }, 400);

            // Time Calculation (Thailand)
            const now = new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Bangkok"}));
            const day = now.getDay();
            const hour = now.getHours();
            const min = now.getMinutes();
            const timeVal = hour + (min / 60);

            // Logic
            let status = "STATUS: DORMANT";
            let subject = "NO CURRENT MANDATE";
            let isSchool = (day >= 1 && day <= 5) && (timeVal >= 8.25 && timeVal <= 16.16);

            if (isSchool) {
                status = "STATUS: ENFORCING";
                const todayClasses = SCHEDULE[day].classes;
                let currentClass = todayClasses.reduce((prev, curr) => (timeVal >= curr.t ? curr : prev), todayClasses[0]);
                subject = "CURRENT: " + currentClass.n;
            }

            // Update UI
            document.getElementById('status-display').innerText = status;
            document.getElementById('subject-display').innerText = subject;
            document.getElementById('mandate-display').innerText = WILLS[Math.floor(Math.random() * WILLS.length)];

            // Start Cooldown (4 Seconds)
            startCooldown(4000);
        }

        function startCooldown(ms) {
            isCoolingDown = true;
            const bar = document.getElementById('cooldown-bar');
            const paper = document.getElementById('paper');
            
            paper.style.opacity = "0.8";
            bar.style.transition = `width ${ms}ms linear`;
            bar.style.width = "100%";

            setTimeout(() => {
                isCoolingDown = false;
                bar.style.transition = "none";
                bar.style.width = "0%";
                paper.style.opacity = "1";
            }, ms);
        }

        // Initial check
        window.onload = weave;
    </script>
</body>
</html>
